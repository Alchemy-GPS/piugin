<?php/** * 支付网关个人收款码接口通知 * @return success */define('APPTYPEID', 0);define('CURSCRIPT', 'notify');define('DISABLEXSSCHECK', 1);require_once('../../../source/class/class_core.php');C::app()->cachelist = array('plugin');C::app()->init();define('CURMODULE', 'achpay');require_once(DISCUZ_ROOT . './source/plugin/achpay/require/function.php');$config = $_G['cache']['plugin']['achpay'];$notify = $_POST;//检测通知签名if (!achpay_check_sign($notify, DISCUZ_ROOT ."source/plugin/achpay/keys/perPubKey.txt")) {    echo 'fail';    exit;}//如果通知中订单号、状态、金额为空  则返回 failif (empty($notify['orderApplyNo'])||empty($notify['status'])||empty($notify['amount'])) {	echo 'fail';	exit;}//检查通知商户号是否与本地商户号一致if ($config['person']!= $notify['merchantId']) {	echo 'fail';	exit;}//通知中含有支付成功if ($notify['status']) {//  获取log id	$logid = DB::result_first("SELECT logid FROM %t WHERE orderno=%s AND status<>1", array('achpay_log', trim($notify['orderApplyNo'])));//	获取金额	$price = DB::result_first("SELECT price FROM %t WHERE orderno=%s AND status<>1", array('achpay_log', trim($notify['orderApplyNo'])));//如果订单号存在并且金额相同	if ($logid && $notify['amount']==$price) {		achpay_finish($logid);        echo 'SUCCESS';        exit;	}}echo 'fail';exit;